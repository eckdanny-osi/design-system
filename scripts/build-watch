#!/usr/bin/env node

const yargs = require('yargs');
const gulp = require('gulp');
const babel = require('gulp-babel');
const sass = require('gulp-sass');
const sourceMaps = require('gulp-sourcemaps');
const tildeImporter = require('node-sass-tilde-importer');

const WATCH_DIR = './src';
const OUT_DIR = './dist';
const FILES_CSS = './src/**/*.scss';

const argv = require('yargs').argv;

gulp.task('css', () => {
  gulp
    .src('./src/**/*.scss')
    .pipe(sourceMaps.init())
    .pipe(sass({ importer: tildeImporter }))
    .pipe(sourceMaps.write('./'))
    .pipe(gulp.dest('./dist'));
});

gulp.task('js', () => {
  gulp
    .src('./src/**/*.@(js|jsx)')
    .pipe(babel())
    .pipe(gulp.dest('./dist'));
});

//
//
//

gulp.watch('./src/**/*.scss', ['css']);

// FIXME glob too greedy
// gulp.watch('./src/**/*.{js,jsx}', ['js']);
gulp.watch(['./src/**/*.{js,jsx}', '!*.{stories,test}.js'], ['js']);
